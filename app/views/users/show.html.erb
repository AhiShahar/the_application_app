<% if flash[:error] %>
<%= flash[:error] %>
<% end %>

<h2><%= @user.first_name %>'s Profile</h2>

<div class="row">
    <div class="col s12 m3">
        <% if @user == @current_user %>
        <h5>Customer List</h5>
        <% @user.approved_customers.each do |c| %>
        <p><%= c.customer.first_name %></p>
        <% end %>
        <% end %>
    </div>
    <div class="col s12 m6">
        <% unless @current_user.present? && (@current_user.is_approved_customer?(@user.id) || @current_user == @user) %>
        <%= link_to "Register to Professional", new_relation_path( @user ) %>
        <% end %>
        <br>
        <ul>
            <li><%= @user.last_name %>,
                <%= @user.first_name %></li>
            <br>
            <% if @current_user.present? && (@current_user.is_approved_customer?( @user.id )|| @current_user == @user) %>
            <li><%= @user.phone %></li>
            <% end %>
            <li><%= @user.email %></li>
            <div><%= @user.description.html_safe %></div>
            <br>
        </ul>

        <% if @current_user.present? && (@current_user.is_approved_customer?( @user.id ) || @current_user == @user ) %>
        <% @calendar.each_with_index do |date, index| %>
        <a class='dropdown-button btn' href='#' data-activates='dropdown<%= index + 1 %>'>
            <%= date %>
        </a>&nbsp;
        <ul id='dropdown<%= index + 1 %>' class='dropdown-content'>
            <% @user.meetings.each do |app| %>
            <% if app.available && date == app.start_time.strftime("%A, %B %d, %Y") %>
            <li><%=link_to app.start_time.strftime("%I:%M %p"), edit_appointment_path(app) %></li>
            <li class="divider"></li>
            <% end %>
            <% end %>
        </ul>
        <% end %>
        <% if @current_user.id == params[:id].to_i %>
        <div class="controls">
            <%= link_to "Create Appointment", new_appointment_path %>
            |
            <%= link_to "Edit Details", edit_user_path %>
            |
            <%= link_to "Delete Account", user_path(@user), :method => :delete, :data => { :confirm => "Are you sure?" } %>
        </div>
        <% end %>
        <% end %>

    </div>
    <div class="col s12 m3">
        <% if @user == @current_user %>
        <h5>Pending Customers</h5>
        <% @user.unapproved_customers.each do |c| %>
        <p><%= link_to c.customer.first_name, approve_relation_path( c.customer ) %></p>
        <% end %>
        <% end %>
    </div>

</div>
